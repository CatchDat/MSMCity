
# MSMCity - City-level Commute Microsimulation

## Overview

Combine user data harvested from mobile phone app with a simulated population at a city-wide (local authority) level, in order to synthesise an OD matrix of commute patterns. 

Only economically active people (according to census data) are considered. 

User data comprises of home and work locations, plus timestamped breadcrumb data, mode of travel

### Data Sources


1. Census data from nomisweb.co.uk, using RESTful API: 

MSOA-level populations with the following characteristics: 
- gender
- age band (6 categories: 16-24, 25-34, 35-44, 45-54, 55-64, 65+)
- economic activity (4 categories: full/part-time (self) employed)
- number of households per MSOA
- MSOA of workplace
- Commute mode of transport

(number of workplaces per MSOA would be useful)

2. TravelAI app data:
- home lat/lon
- work lat/long
- timestamped breadcrumb data
- mode of travel?
- gender
- age mapped to age band

Approximately 5000 working population per MSOA
Approximately 5000 households per MSOA

3. Routing data from transportAPI.com, using RESTful API.
- Restricted to 1000 queries per day

## Methodology

### Microsimulation

Automated download (and cacheing of) census data from www.nomisweb.co.uk, at mid-layer super output area (MSOA) level, queried by local authority.

- MSOAs within local authority.
- Origin-destination data per MSOA (no breakdown available).
- Economic data, broken down by gender, economic activity type, and age band.
- Households per MSOA.

Generate synthetic population categorised on sex, age band, economic activity type, from census data
Assign home location randomly within MSOA (will not match distribution of household sizes)

Assign cleaned app user data to the synthetic population. 

Create OD matrix based on 
1. home and work locations either determined from app data, or randomly sampled within MSOA. 


## Detail

### Census API

#### Metadata

1. Translate local authority string e.g "Newcastle upon Tyne" to MOSA codes (nomisweb internal, not "standard")

2. Query table to determine what fields (columns) available.

3. Construct appropriate queries and retrieve data. Since census data is essentially static it is cached locally to reduce load on remote server. 
(The service requires an API key for unlimited downloads - without this results can be truncated)

### Routing API

3. Construct appropriate queries and retrieve data. Again data is cached locally to reduce load on remote server. 
(The service requires an API key and queries are limited to a daily maximum)

## Algorithm

1. Select Region

2. Construct queries to collect the following data:
- MSOAs within region
- per MSOA (working) population data: age band, gender, economic activity type, workplace MSOA, normal mode of transport

3. Synthesise population 

4. Extract users from app data, including age band, gender, (economic activity assumed), lon/lat of home and work

5. Assign users to synthetic population

4. For remainder of population, sample and assign OD points (randomly) within each MSOA

5. Use routing API to generate routes

6. Plot routes



# References

https://developer.transportapi.com/docs?raml=https://transportapi.com/v3/raml/transportapi.raml

https://www.nomisweb.co.uk/api/v01/help




